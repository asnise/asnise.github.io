<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Skill Tree Editor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="app">
  <div class="viewport" id="viewport">
    <svg id="canvas">
      <defs>
        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
          <path d="M 40 0 L 0 0 0 40" fill="none" stroke="var(--grid-line)" stroke-width="1" />
        </pattern>
      </defs>
      <g id="transform-layer">
        <rect id="bg-rect" x="-50000" y="-50000" width="100000" height="100000" fill="url(#grid)" />
        <g id="links-layer"></g>
        <path id="temp-link" class="temp-link" d="" />

        <g id="shape-tool-layer" style="display:none"></g>

        <g id="nodes-layer"></g>
      </g>
    </svg>

    <div class="toolbar">
      <button class="tool-btn active" id="tool-select" title="Select (V)">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z"/>
        </svg>
      </button>
      <button class="tool-btn" id="tool-hand" title="Pan (Space)">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 0l2.5 2.5H9v3H7v-3H5.5L8 0z"/>
          <path d="M16 8l-2.5-2.5V7h-3v2h3v1.5L16 8z"/>
          <path d="M8 16l-2.5-2.5H7v-3h2v3h1.5L8 16z"/>
          <path d="M0 8l2.5 2.5V9h3V7h-3V5.5L0 8z"/>
        </svg>
      </button>
      <div class="tool-separator"></div>

      <button class="tool-btn" id="tool-shape" title="Shape Generator (G)" onclick="window.cmdToggleShapeTool()">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M2 2v12h12V2H2zm1 1h10v10H3V3z"/>
          <circle cx="2" cy="2" r="1.5" />
          <circle cx="14" cy="2" r="1.5" />
          <circle cx="2" cy="14" r="1.5" />
          <circle cx="14" cy="14" r="1.5" />
        </svg>
      </button>

      <div class="tool-separator"></div>

      <button class="tool-btn" id="tool-undo" title="Undo (Ctrl+Z)">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
          <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
        </svg>
      </button>
      <button class="tool-btn" id="tool-redo" title="Redo (Ctrl+Y)">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
          <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966a.25.25 0 0 1 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
        </svg>
      </button>
      <div class="tool-separator"></div>
      <button class="tool-btn" id="tool-import" title="Import JSON">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M.5 9.5a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V10a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V10a.5.5 0 0 1 .5-.5z"/>
          <path d="M7.646 10.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 1 0-.708-.708L8.5 9.293V1.5a.5.5 0 0 0-1 0v7.793L5.354 7.146a.5.5 0 1 0-.708.708l3 3z"/>
        </svg>
      </button>
      <button class="tool-btn" id="tool-export" title="Export JSON">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M.5 9.9a.5.5 0 0 0-.5.5v2.5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V10.4a.5.5 0 0 0-1 0v2.5a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V10.4a.5.5 0 0 0-.5-.5z"/>
          <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
        </svg>
      </button>
      <div class="tool-separator"></div>
      <button class="tool-btn play-mode" id="tool-play" title="Play Game Mode">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
        </svg>
      </button>

      <button class="tool-btn" id="tool-reset-view" title="Fit View">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1h-4zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5zM.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5z"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="inspector" id="inspector">
    <div class="inspector-header" id="inspector-header">
      <div class="inspector-header-main">
        <span>Properties</span>
      </div>
      <div class="inspector-header-controls">
        <span style="font-size:10px; opacity:0.6;">v3.0</span>
      </div>
    </div>
    <div id="inspector-content">
      <div class="empty-state">
        Select a node to edit properties.<br><br>
        <b>Right Click</b> to add nodes.<br>
        <b>Alt + Drag</b> to link nodes.<br>
        <b>Alt + Click</b> to toggle Active.<br>
      </div>
    </div>
  </div>
</div>

<div id="context-menu"></div>

<div id="shape-controls" class="panel-floating" style="display: none;">
  <div class="panel-row">
    <label>Shape:</label>
    <select id="shape-type-select" onchange="window.updateShapeSettings()">
      <option value="rect">Rectangle</option>
      <option value="poly">Polygon</option>
    </select>
  </div>
  <div class="panel-row" id="shape-poly-settings" style="display:none">
    <label>Corners:</label>
    <input type="number" id="shape-sides-input" value="5" min="3" max="20" onchange="window.updateShapeSettings()" style="width: 50px;">
  </div>
  <div class="panel-row buttons">
    <button class="btn-action btn-danger" onclick="window.cmdToggleShapeTool()">Cancel</button>
    <button class="btn-action btn-primary" onclick="window.cmdCommitShape()">Accept</button>
  </div>
</div>

<div id="parent-modal-backdrop">
  <div id="parent-modal">
    <div id="parent-modal-header">
      <span>Select Parents</span>
      <button class="btn-icon-only" onclick="closeParentModal()" title="Close">x</button>
    </div>
    <div id="parent-modal-body">
      </div>
    <div id="parent-modal-footer">
      <button class="btn-action" onclick="closeParentModal()">Cancel</button>
      <button class="btn-action btn-primary" onclick="saveParentModal()">Save</button>
    </div>
  </div>
</div>

<div id="game-mode">
  <div id="game-hud">
    <div class="game-stat">
      <span class="game-stat-label">Available Points</span>
      <span class="game-stat-val" id="game-points"></span>
    </div>
    <div class="game-stat" style="align-items: flex-end;">
      <button class="btn-action btn-danger" style="width: auto; margin:0;" onclick="closeGameMode()">Exit Game</button>
    </div>
  </div>
  <div id="game-canvas-container">
    <svg id="game-canvas">
      <g id="game-transform-layer">
        <g id="game-links-layer"></g>
        <g id="game-nodes-layer"></g>
      </g>
    </svg>
  </div>
</div>

<input type="file" id="import-input" accept="application/json" style="display:none" />

<script type="module" src="main.js"></script>
</body>
</html>
